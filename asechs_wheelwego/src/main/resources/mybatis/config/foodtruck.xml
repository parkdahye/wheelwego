<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="foodtruck"> 	
<resultMap type="truckVO" id="truckRM">
      <result property="foodtruckNumber" column="foodtruck_number" />
      <result property="sellerId" column="seller_id" />
      <result property="foodtruckName" column="foodtruck_name"/>     
	  <result property="fileVO.filepath" column="foodtruck_filepath"/>
	  <result property="foodList.fileVO.filepath" column="menu_filename"/>
</resultMap>
<resultMap type="foodVO" id="foodRM">
<result property="menuId" column="menu_id" />
<result property="foodTruckNumber" column="foodtruck_number" />
<result property="menuName" column="menu_name"/>
<result property="menuPrice" column="menu_price"/>
<result property="fileVO.filepath" column="menu_filename"/>
</resultMap>
<select id="foodtruckList" resultMap="truckRM">
		select t.*, f.foodtruck_filepath
		from(select * from foodtruck)t, foodtruckfile f
		where t.foodtruck_number=f.foodtruck_number
</select>
<select id="searchFoodTruckList" resultMap="truckRM">
select t.*, f.foodtruck_filepath
		from(select * from foodtruck)t, foodtruckfile f
		where t.foodtruck_number=f.foodtruck_number and t.foodtruck_name like '%' || #{value} || '%'
</select>
<select id="getTruckListTotalContentCount" resultType="Integer">
		select count(*) from foodtruck
</select>
<select id="pagingTruckList" parameterType="pagingBean" resultMap="truckRM" resultType="truckVO">
select f.foodtruck_filepath, t.foodtruck_name, t.foodtruck_number FROM(
	SELECT row_number() over(order by foodtruck_number desc) as rnum, foodtruck_name, foodtruck_number from foodtruck)t, foodtruckfile f
	where t.foodtruck_number=f.foodtruck_number and rnum between #{startRowNumber} and #{endRowNumber}
</select>
<select id="foodtruckDetail" resultMap="truckRM">
select t.*, f.foodtruck_filepath
		from(select * from foodtruck)t, foodtruckfile f
		where t.foodtruck_number=f.foodtruck_number and t.foodtruck_number=#{value}
</select>
<select id="foodListDetail" resultMap="foodRM">
select * from menu where foodtruck_number=#{value}
</select>

<select id="foodTruckAndMenuDetail" parameterType="String" resultMap="truckRM">
select t.*, f.foodtruck_filepath, m.menu_filename
		from(select * from foodtruck)t, foodtruckfile f, menu m
		where t.foodtruck_number=f.foodtruck_number and t.foodtruck_number=m.foodtruck_number and t.foodtruck_number=#{value}
</select>
<select id="searchFoodTruckByGPS" resultMap="truckRM" parameterType="truckVO">
select * from (
select * from foodtruck
where (latitude between #{latitude}-0.009 and #{latitude}+0.009) and (longitude between #{longitude}-0.012 and #{longitude}+0.012)) TMP 
</select>
</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















