<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="foodtruck"> 	
<resultMap type="truckVO" id="truckRM">
      <result property="foodtruckNumber" column="foodtruck_number" />
      <result property="sellerId" column="seller_id" />
      <result property="foodtruckName" column="foodtruck_name"/>     
</resultMap>
<resultMap type="reviewVO" id="reviewRM">
	<result property="reviewNo" column="review_no"/>
	<result property="foodtruckNumber" column="foodtruck_number"/>
	<result property="customerId" column="customer_id"/>
	<result property="reviewContent" column="review_content"/>
	<result property="reviewTimeposted" column="review_timeposted"/>
</resultMap>
<select id="foodtruckList" resultMap="truckRM">
		select t.*, f.foodtruck_filepath
		from(select * from foodtruck)t, foodtruckfile f
		where t.foodtruck_number=f.foodtruck_number
</select>
<select id="searchFoodTruckList" resultMap="truckRM">
	select * from foodtruck where foodtruck_name like '%'|| #{value} || '%'
</select>
<select id="getTruckListTotalContentCount" resultType="Integer">
		select count(*) from foodtruck
</select>
<select id="pagingTruckList" parameterType="pagingBean" resultMap="truckRM" resultType="truckVO">
SELECT f.foodtruck_filename1, f.foodtruck_name FROM(
		SELECT row_number() over(order by foodtruck_number desc) as rnum, foodtruck_filename1, foodtruck_name from foodtruck)
		f where rnum between #{startRowNumber} and #{endRowNumber}
</select>
<select id="searchFoodTruckByGPS" resultMap="truckRM" parameterType="truckVO">
select * from (
select * from foodtruck
where (latitude between #{latitude}-0.009 and #{latitude}+0.009) and (longitude between #{longitude}-0.012 and #{longitude}+0.012)) TMP 
</select>

<insert id="registerReview" parameterType="reviewVO">
<selectKey order="BEFORE" keyProperty="reviewNo" resultType="String">
	select review_seq.nextval from dual
</selectKey>
insert into review(review_no,foodtruck_number,customer_id,review_content,review_timeposted,grade) 
values(#{reviewNo},#{foodtruckNumber},#{customerId},#{reviewContent},sysdate,#{grade})
</insert>

<select id="getReviewListByTruckNumber" resultMap="reviewRM" parameterType="pagingBean">
select * from (select row_number() over(order by review_no desc) as rnum ,review_no,foodtruck_number,customer_id,
review_content,to_char(review_timeposted,'YYYY.MM.DD') as review_timeposted, grade from review
where foodtruck_number=#{searchWord})
where rnum between #{startRowNumber} and #{endRowNumber}
</select>

<select id="getReivewTotalCount" resultType="int">
	select count(*) from review where foodtruck_number=#{value}
</select>
</mapper>
 

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















