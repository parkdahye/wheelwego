<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<resultMap type="boardVO" id="freeBoardListRM">
		<result property="no" column="freeboard_no"/>
		<result property="id" column="id"/>
		<result property="title" column="freeboard_title"/>
		<result property="content" column="freeboard_content"/>
		<result property="timePosted" column="freeboard_timeposted"/>
		<result property="hits" column="freeboard_hits"/>
		<result property="fileVO.no" column="freeboard_no"/>
		<result property="fileVO.filepath" column="freeboardfile_filepath"/>
		<!-- <result property="file" column="freeboard_filename1"/> -->
	</resultMap>
	<select id="getFreeBoardList" parameterType="pagingBean" resultMap="freeBoardListRM" resultType="boardVO">
		<!-- select freeboard_no, id, freeboard_title, freeboard_content, freeboard_timePosted, freeboard_hits
		 from freeboard -->
		SELECT f.freeboard_no, f.id, f.freeboard_title, f.freeboard_content, f.freeboard_timePosted, f.freeboard_hits, m.id FROM(
		SELECT row_number() over(order by freeboard_no desc) as rnum, freeboard_no, id, freeboard_title, freeboard_content,
		to_char(freeboard_timePosted,'YYYY.MM.DD') as freeboard_timePosted , freeboard_hits from freeboard
		)f, member m where f.id=m.id and rnum between #{startRowNumber} and #{endRowNumber}
		order by freeboard_no desc
	</select>
	<resultMap type="boardVO" id="businessInfoBoardListRM">
		<result property="no" column="information_no"/>
		<result property="id" column="id"/>
		<result property="title" column="information_title"/>
		<result property="content" column="information_content"/>
		<result property="timePosted" column="information_timeposted"/>
		<result property="hits" column="information_hits"/>
	</resultMap>
	<select id="getBusinessInfoBoardList" parameterType="pagingBean" resultMap="businessInfoBoardListRM" resultType="boardVO">
		SELECT b.information_no, b.id, b.information_title, b.information_content, b.information_timeposted, b.information_hits, m.id FROM(
		SELECT row_number() over(order by information_no desc) as rnum, information_no, id, information_title, information_content,
		to_char(information_timeposted,'YYYY.MM.DD') as information_timeposted ,information_hits from information
		)b, member m where b.id=m.id and rnum between #{startRowNumber} and #{endRowNumber}
		order by information_no desc
	</select>
	<select id="getFreeBoardTotalContentCount" resultType="Integer">
		select count(*) from freeboard
	</select>
	<select id="getBusinessInfoBoardTotalContentCount" resultType="Integer">
		select count(*) from information
	</select>
	<select id="getQnATotalContentCount" resultType="Integer">
		select count(*) from qna
	</select>
	<resultMap type="boardVO" id="QnABoardListRM">
		<result property="no" column="qna_no"/>
		<result property="id" column="id"/>
		<result property="title" column="qna_title"/>
		<result property="content" column="qna_content"/>
		<result property="timePosted" column="qna_timeposted"/>
		<result property="hits" column="qna_hits"/>
	</resultMap>
	<select id="getQnABoardList" parameterType="pagingBean" resultMap="QnABoardListRM" resultType="boardVO">
		SELECT q.qna_no, q.id, q.qna_title, q.qna_content, q.qna_timeposted, q.qna_hits, m.id FROM(
		SELECT row_number() over(order by qna_no desc) as rnum, qna_no, id, qna_title, qna_content,
		to_char(qna_timeposted,'YYYY.MM.DD') as qna_timeposted , qna_hits from qna
		)q, member m where q.id=m.id and rnum between #{startRowNumber} and #{endRowNumber}
		order by qna_no desc
	</select>
	<select id="getFreeBoardDetail" resultMap="freeBoardListRM" resultType="boardVO" parameterType="String">
		select freeboard_no, id, freeboard_title, freeboard_content, to_char(freeboard_timeposted,'YYYY.MM.DD HH:mm:ss') as freeboard_timeposted,
		freeboard_hits from freeboard where freeboard_no=#{value}
		<!-- select f.freeboard_no, f.id, f.freeboard_title, f.freeboard_content,
		 to_char(f.freeboard_timeposted,'YYYY.MM.DD HH:mm:ss') as freeboard_timeposted,
		 f.freeboard_hits, fi.freeboard_no, fi.freeboardfile_filepath 
		 from freeboard f, freeboardfile fi where f.freeboard_no=fi.freeboard_no and f.freeboard_no=#{value} -->
	</select>
	<resultMap type="fileVO" id="freeboardFileNameRM">
		<result property="no" column="freeboard_no"/>
		<result property="filepath" column="freeboardfile_filepath"/>
	</resultMap>
	<select id="getFreeBoardFilePath" resultType="fileVO" parameterType="String" resultMap="freeboardFileNameRM">
		select freeboardfile_filepath from freeboardfile where freeboard_no=#{value}
	</select>
	<delete id="freeboardDelete" parameterType="String">
		delete freeboard where freeboard_no=#{value}
	</delete>
	<update id="updateCount" parameterType="int">
		update freeboard set freeboard_hits=freeboard_hits+1 where freeboard_no=#{value}
	</update>
		<update id="updateBoard" parameterType="boardVO">
		update freeboard set freeboard_title=#{title},freeboard_content=#{content},freeboard_timeposted=sysdate where freeboard_no=#{no}
	</update>

	<insert id="freeboardWrite" parameterType="boardVO">
		<selectKey keyProperty="no" resultType="String" order="BEFORE">
			select freeboard_seq.nextval from dual
		</selectKey>
		insert into freeboard(freeboard_no, id, freeboard_title, freeboard_content, freeboard_timePosted, freeboard_hits)
		values(#{no}, #{id},#{title},#{content},sysdate,#{hits})
	</insert>
	<resultMap type="boardVO" id="freeboardWriteFileUploadRM">
		<result property="fileVO.no" column="freeboard_no"/>
		<result property="fileVO.filePath" column="freeboardfile_filepath"/>
	</resultMap>
	<insert id="freeboardWriteFileUpload" parameterType="boardVO">
		insert into freeboardfile(freeboard_no, freeboardfile_filepath)values(#{fileVO.no},#{fileVO.filepath})
	</insert>
	
	<select id="getNameById" resultType="memberVO" parameterType="boardVO">
	select m.member_name as memberName from freeboard f, member m where m.id=f.id and f.id=#{id} and f.freeboard_no=#{no}
	</select>
	<!-- 창업게시판 -->
		<select id="getBusinessBoardDetail" resultMap="businessInfoBoardListRM" resultType="boardVO">
		select information_no, id, information_title, information_content, to_char(information_timeposted,'YYYY.MM.DD HH:mm:ss')
		information_timeposted,
		information_hits from information where information_no=#{value}
	</select>
	<delete id="businessDelete" parameterType="String">
		delete information where information_no=#{value}
	</delete>
	<update id="updateHitsBusiness" parameterType="int">
		update information set information_hits=information_hits+1 where information_no=#{value}
	</update>
		<update id="business_updateBoard" parameterType="boardVO">
		update information set information_title=#{title},information_content=#{content},information_timeposted=sysdate where information_no=#{no}
	</update>
	<select id="business_getNameById" resultType="memberVO">
	select m.member_name as membername
	from information f, member m
	where m.id=f.id and f.id=#{value}
	</select>
</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















